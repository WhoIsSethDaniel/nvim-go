machine:
  pre:
    - curl -sSL https://github.com/circleci/docker/raw/docker-1.11.2/install-circleci-docker.sh | bash -s -- 1.10.0
    - sudo chmod 0755 /usr/bin/docker
    - mkdir ~/docker
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"

test:
  override:
    - docker version
    - docker info
    - if [[ -e ~/docker/golang_1.7.0.tar ]]; then docker load -i ~/docker/golang_1.7.0.tar; fi
    - docker build --rm -t "zchee/nvim-go:latest" .
    - mkdir -p ~/docker; docker save golang:1.7.0 > ~/docker/golang_1.7.0.tar
    - docker run --rm "zchee/nvim-go:latest"
